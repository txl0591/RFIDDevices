/*********************************************************
  Copyright (C), 2013-2016
  File name:	Storage.c
  Author:   	
  Version:   	1.0
  Date: 		13.11.23
  Description:  
  History:                   
    1. Date:
       Author:
       Modification:
    2. ...
*********************************************************/
#include "Include.h"

#define DEFAULT_PWD_LEN			19

static const unsigned char default_pwd[DEFAULT_PWD_LEN*16] = 
{
	0xCC,0x01,0x10,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
	0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,

	0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x31,0x34,0x39,0x31,0x23,0x35,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x67,0x6A,0x49,0x46,0x28,0x31,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x33,0x35,0x46,0x5E,0x25,0x51,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x25,0x45,0x2C,0x33,0x39,0x39,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x42,0x72,0x78,0x4B,0x33,0x59,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x7A,0x57,0x34,0x4E,0x73,0x32,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x4A,0x73,0x59,0x2C,0x73,0x73,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x57,0x2F,0x34,0x6A,0x47,0x3C,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x32,0x5E,0x21,0x33,0x75,0x4A,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x2C,0x38,0x79,0x6F,0x5E,0x75,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x7D,0x59,0x23,0x25,0x32,0x32,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x45,0x26,0x56,0x73,0x35,0x40,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x64,0x35,0x34,0x36,0x32,0x31,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x30,0x61,0x57,0x64,0x66,0x29,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,
	0x31,0x32,0x78,0x23,0x57,0x53,0xff,0x07,0x80,0x69,0x00,0x00,0x00,0x00,0x00,0x00,

	0x2A,0x61,0x66,0x5E,0x66,0x39,0x6F,0x32,0x77,0x35,0x66,0x76,0x46,0x31,0x23,0x51,
};


#if _STORAGE_MODULE_
/*************************************************
  Function:		StorageReadByte
  Description:  
  Input:		
  Output:		
  Return:		
  Others:
*************************************************/
INT8U StorageReadByte(INT16U addr)
{
	#if (STORAGE_TYPE == _SOTRAGE_IAP_)
	return IAPReadByte(addr);
	#endif
}

/*************************************************
  Function:		StorageWriteByte
  Description:  
  Input:		
  Output:		
  Return:		
  Others:
*************************************************/
void StorageWriteByte(INT16U addr, INT8U buf)
{
	#if (STORAGE_TYPE == _SOTRAGE_IAP_)
	IAPWriteByte(addr,buf);
	#endif
}

/*************************************************
  Function:		StorageRead
  Description:  
  Input:		
  Output:		
  Return:		
  Others:
*************************************************/
INT8U StorageRead(INT16U addr, INT8U *buf, INT16U len)
{
	int i,nlen = 0;
	#if (STORAGE_TYPE == _SOTRAGE_IAP_)
	for(i = 0; i < len; i++)
	{
		buf[i] = StorageReadByte(addr+i);
		nlen++;
	}
	#endif
	return nlen;
}

/*************************************************
  Function:		StorageWrite
  Description:  
  Input:		
  Output:		
  Return:		
  Others:
*************************************************/
INT16U StorageWrite(INT16U addr, INT8U *buf, INT16U len)
{
	int i,nlen = 0;
	#if (STORAGE_TYPE == _SOTRAGE_IAP_)
	for(i = 0; i < len; i++)
	{
		StorageWriteByte(addr+i,buf[i]);
		nlen++;
	}
	#endif
	return nlen;
}


#endif

/*************************************************
  Function:		StorageRecover
  Description:  
  Input:		
  Output:		
  Return:		
  Others:
*************************************************/
void StorageRecover(void)
{
	StorageWrite(ADDRESS_INIT,default_pwd,(DEFAULT_PWD_LEN*16));
}

/*************************************************
  Function:		StorageInit
  Description:  
  Input:		
  Output:		
  Return:		
  Others:
*************************************************/
void StorageInit(void)
{
	INT8U Init = StorageReadByte(ADDRESS_UART_VERSION);
	if(0xAA != Init)
	{
		StorageRecover();
	}
}

